# LINE公式アカウント対応 要件定義書

## 1. プロジェクト概要

### 1.1. 追加機能名
LINE Official Account Support

### 1.2. 背景
既存のMulti Channel Reply Support Toolは、Gmail、Chatwork、Google Chatに対応済み。
LINE公式アカウントは日本国内での顧客サポートにおいて重要なチャネルであり、対応することで包括的なマルチチャネル対応が実現される。

### 1.3. 目的
LINE Official Account Manager (https://manager.line.biz/) 上で、既存チャネルと同様のAI返信支援機能を提供し、LINE経由の顧客対応業務を効率化する。

## 2. 対象ユーザー・利用シーン

### 2.1. 主要ペルソナ
- **カスタマーサポート担当者**: LINE公式アカウントでの問い合わせ対応
- **店舗運営者**: ECサイトや実店舗のLINE経由での顧客対応
- **営業担当**: LINE公式アカウントでのリード獲得・育成

### 2.2. 利用シーン
- 1:1チャットでの個別問い合わせ対応
- グループチャットでの複数人対話
- 予約・注文確認などの定型的な問い合わせ
- 商品説明・サポート情報の提供

## 3. 機能要件

### 3.1. F-LINE-01: LINE Manager UI上での返信ボタン表示
- **内容**: LINE Official Account Managerのチャット画面に「AI返信」ボタンを表示
- **配置位置**: 
  - メッセージ入力エリア近傍
  - 既存のLINE UIを阻害しない位置
  - フローティングボタンとしての代替表示対応
- **デザイン**: 既存チャネルと統一したグリーン系カラー

### 3.2. F-LINE-02: LINEメッセージ履歴の取得・解析
- **対象メッセージ**: 
  - テキストメッセージ（優先）
  - スタンプ（「スタンプが送信されました」等のテキスト化）
  - 画像・ファイル（「画像が送信されました」等のテキスト化）
- **文脈取得**: 直近5-10件のメッセージ履歴
- **顧客情報**: 可能であれば顧客名・IDの取得

### 3.3. F-LINE-03: LINE特有の要素への対応
- **スタンプ**: 「ありがとうございます」等の意図推定
- **リッチメニュー**: ボタン選択の文脈考慮
- **クイックリプライ**: 選択肢提示の文脈考慮
- **絵文字**: LINE絵文字の適切な解釈

### 3.4. F-LINE-04: LINE向け返信案生成
- **トーン調整**: LINEに適したカジュアル・親しみやすい文体
- **絵文字提案**: 適切な絵文字の自動挿入提案
- **改行・レイアウト**: LINE表示に最適化された形式
- **長文対応**: 長い返信の適切な分割提案

### 3.5. F-LINE-05: 返信案の挿入・送信
- **入力欄特定**: LINE Managerのメッセージ入力欄を正確に特定
- **テキスト挿入**: 生成された返信案の挿入
- **フォーマット保持**: 改行・絵文字の適切な挿入
- **送信制御**: 誤送信防止（入力のみ、送信はユーザー操作）

## 4. 非機能要件

### 4.1. パフォーマンス
- **応答時間**: 既存要件と同様、3秒以内での返信案生成
- **メッセージ解析**: DOM解析処理の軽量化
- **メモリ使用量**: LINE Manager UIへの影響を最小限に抑制

### 4.2. UI/UX
- **LINE UIとの調和**: 既存のLINE Manager UIに自然に統合
- **レスポンシブ対応**: 様々な画面サイズでの適切な表示
- **アクセシビリティ**: キーボード操作・スクリーンリーダー対応

### 4.3. セキュリティ・コンプライアンス
- **LINE利用規約遵守**: LINE公式アカウント利用規約に準拠
- **個人情報保護**: メッセージ内容のローカル処理のみ
- **データ保持**: チャット履歴の永続化なし
- **暗号化**: chrome.storage.local使用時の適切な暗号化

### 4.4. 拡張性・保守性
- **既存アーキテクチャ活用**: ServiceStrategyパターンの継続使用
- **設定統合**: 既存の設定画面への統合
- **ログ統合**: 既存ログシステムとの統合

## 5. 技術的検討事項

### 5.1. LINE Manager画面の技術特性
- **SPA構造**: React/Vue等のSPAフレームワーク使用想定
- **動的DOM**: チャット画面の動的な要素変更への対応
- **セレクタ戦略**: 複数のセレクタパターンでの要素特定
- **イベント処理**: React Synthetic Events等への対応

### 5.2. 実装アプローチ
- **DOM監視**: MutationObserverでの画面変化監視
- **非同期処理**: メッセージ読み込み完了の待機処理
- **エラーハンドリング**: LINE特有のエラーケースへの対応
- **フォールバック**: 要素特定失敗時の代替手段

### 5.3. 制約事項
- **CSP制約**: LINE ManagerのContent Security Policy
- **API制限**: LINE APIへの直接アクセス不可
- **認証**: LINE Manager認証状態への依存
- **更新頻度**: LINE Manager UIの更新への追従必要性

## 6. 開発フェーズ・優先順位

### 6.1. Phase 1 (MVP): 基本機能実装
- **優先度**: 高
- **内容**: 
  - DOM構造解析とボタン配置
  - 基本的なメッセージ履歴取得
  - シンプルな返信案生成・挿入
- **完了条件**: 1:1チャットでの基本的な返信支援が動作

### 6.2. Phase 2: LINE特有機能対応
- **優先度**: 中
- **内容**:
  - スタンプ・画像メッセージの解釈
  - LINE向けトーン調整
  - 絵文字挿入提案
- **完了条件**: LINEらしい返信案の生成が可能

### 6.3. Phase 3: 高度機能・最適化
- **優先度**: 低
- **内容**:
  - グループチャット対応
  - リッチメニュー連携
  - パフォーマンス最適化
- **完了条件**: 商用レベルでの安定運用

## 7. リスク要因と対策

### 7.1. 技術リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| LINE Manager UI構造の頻繁な変更 | 高 | 複数セレクタ戦略、UI変更検知機能 |
| CSP制約による機能制限 | 中 | content script内での完結実装 |
| 動的DOM要素の特定困難 | 中 | MutationObserver + 待機ロジック |

### 7.2. ビジネスリスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| LINE利用規約抵触 | 高 | 法務確認、利用規約準拠設計 |
| パフォーマンス影響 | 中 | 軽量実装、メモリ管理強化 |
| ユーザー導入障壁 | 低 | 詳細ドキュメント、段階的機能提供 |

## 8. 成功指標

### 8.1. 定量指標
- **機能動作率**: 95%以上のケースでボタン表示・返信生成が成功
- **応答時間**: 3秒以内での返信案生成維持
- **エラー率**: 5%以下のエラー発生率

### 8.2. 定性指標
- **ユーザビリティ**: 既存チャネルと同等の使いやすさ
- **生成品質**: LINEに適した自然な返信案の生成
- **安定性**: LINE Manager UI更新時の継続動作

## 9. 実装スケジュール概算

- **要件確定・設計**: 1週間
- **Phase 1 実装**: 2-3週間
- **Phase 2 実装**: 2週間  
- **Phase 3 実装**: 1-2週間
- **テスト・調整**: 1週間

**総開発期間**: 約7-9週間

## 10. 次のアクション

1. **DOM構造調査**: LINE Official Account Managerの詳細分析
2. **プロトタイプ開発**: 最小限のボタン表示とメッセージ取得
3. **ユーザーテスト**: 実際のLINE運用担当者での動作確認
4. **利用規約確認**: LINE公式の利用規約・ガイドライン確認