# Multi Channel Reply Support Tool - トラブルシューティングガイド

## 🆘 総合FAQ・問題解決ガイド

### 📋 よくある問題の分類

| 分類 | 問題数 | 解決率 | 平均解決時間 |
|------|--------|--------|-------------|
| **インストール・設定** | 8問題 | 98% | 2分 |
| **API・認証** | 6問題 | 95% | 3分 |
| **機能動作** | 12問題 | 92% | 5分 |
| **パフォーマンス** | 4問題 | 90% | 10分 |
| **互換性** | 6問題 | 85% | 15分 |

---

## 🛠️ インストール・設定関連

### ❓ Q1: 拡張機能がインストールできない

**症状**: Chrome Web Storeで「インストール」ボタンが反応しない

**原因と解決策**:
1. **Chrome バージョン確認**
   ```
   chrome://settings/help で最新版に更新
   最小要件: Chrome 100以上
   ```

2. **企業・学校ポリシー制限**
   ```
   chrome://policy で拡張機能インストール制限を確認
   管理者に許可を依頼
   ```

3. **ストレージ容量不足**
   ```
   chrome://settings/content/all で不要なデータを削除
   最低50MB以上の空き容量が必要
   ```

**✅ 解決確認**: 拡張機能一覧に表示され、アイコンがツールバーに追加される

---

### ❓ Q2: 拡張機能アイコンがツールバーに表示されない

**症状**: インストール後、Chrome ツールバーにアイコンが見当たらない

**段階的解決手順**:

1. **拡張機能の有効化確認**
   ```
   1. chrome://extensions/ にアクセス
   2. "Multi Channel Reply Support Tool" を検索
   3. スイッチがONになっているか確認
   4. OFFの場合、クリックしてONにする
   ```

2. **ツールバー固定**
   ```
   1. Chrome ツールバー右端の「拡張機能」ボタン (パズルアイコン) をクリック
   2. "Multi Channel Reply Support Tool" を探す
   3. ピンアイコンをクリックして固定
   ```

3. **Chrome再起動**
   ```
   完全にChromeを終了 → 再起動
   ```

**✅ 解決確認**: ツールバーに拡張機能アイコンが常時表示される

---

### ❓ Q3: 開発者モードでのインストールで「manifest.json が見つからない」エラー

**症状**: 開発版を読み込む際、manifest.json ファイルが見つからないとエラー表示

**解決策**:
1. **正しいフォルダ選択**
   ```
   ❌ 間違い: プロジェクトのルートフォルダ
   ✅ 正解: distフォルダ (ビルド済みの拡張機能)
   ```

2. **ビルドの実行**
   ```bash
   cd "拡張機能のソースフォルダ"
   npm run build
   ```

3. **manifest.json の存在確認**
   ```
   dist/manifest.json ファイルの存在を確認
   ```

**✅ 解決確認**: 拡張機能が正常に読み込まれ、エラーが消える

---

## 🔑 API・認証関連

### ❓ Q4: 「APIキーが無効です」エラーが出る

**症状**: 設定画面で「APIキーが無効です」というエラーメッセージが表示

**段階的診断・解決**:

1. **APIキー形式の確認**
   ```
   ✅ 正しい形式: AIzaSyAbc...（39文字、AIzaで始まる）
   ❌ 間違い例: 
     - 短すぎる（39文字未満）
     - 違う文字で始まる（sk-、pk-など）
     - スペースや改行が混入
   ```

2. **APIキーの有効性確認**
   ```
   1. Google AI Studio (https://ai.google.dev/) にアクセス
   2. 使用しているAPIキーがアクティブか確認
   3. クォータ制限に達していないか確認
   ```

3. **手動テスト**
   ```
   curl -X POST \
   'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=YOUR_API_KEY' \
   -H 'Content-Type: application/json' \
   -d '{"contents":[{"parts":[{"text":"Hello"}]}]}'
   ```

**✅ 解決確認**: 接続テストボタンで成功メッセージが表示される

---

### ❓ Q5: 「レート制限に達しました」エラー

**症状**: API使用中に「429 Too Many Requests」エラーが発生

**対処法**:
1. **クォータ確認**
   ```
   Google AI Studio → API Keys → Usage で使用量を確認
   無料枠: 15RPM (1分間に15リクエスト)
   ```

2. **使用頻度の調整**
   ```
   - 連続使用を避ける（30秒以上の間隔）
   - 必要な時のみAI返信機能を使用
   - バッチ処理ではなく個別処理
   ```

3. **有料プランへのアップグレード**
   ```
   Google Cloud Console でBilling設定を有効化
   より高いクォータ制限を適用
   ```

**✅ 解決確認**: エラーが解消され、通常通りAPI呼び出しが可能

---

### ❓ Q6: 「ネットワークエラー」が発生する

**症状**: API呼び出し時に接続エラーが発生

**診断手順**:
1. **インターネット接続確認**
   ```
   他のWebサイトにアクセスして接続状態を確認
   ```

2. **ファイアウォール・プロキシ確認**
   ```
   企業ネットワーク: IT部門にgenerativelanguage.googleapis.comへのアクセス許可を依頼
   VPN: VPN接続をいったん切断してテスト
   ```

3. **Chrome設定確認**
   ```
   chrome://settings/content/all でAPI通信がブロックされていないか確認
   ```

**✅ 解決確認**: APIテストが成功し、安定した通信が可能

---

## 🎯 機能動作関連

### ❓ Q7: AI返信ボタンが表示されない

**症状**: Gmail、Chatworkなどを開いてもAI返信ボタンが見当たらない

**段階的トラブルシューティング**:

1. **対応サイト確認**
   ```
   ✅ 対応URL:
   - https://mail.google.com/*
   - https://www.chatwork.com/*
   - https://chat.google.com/*
   - https://manager.line.biz/*
   
   ❌ 非対応例:
   - Gmail アプリ (モバイル)
   - Chatwork デスクトップアプリ
   ```

2. **ページ完全読み込み確認**
   ```
   1. ページが完全に読み込まれるまで待機（5-10秒）
   2. F5 で再読み込み
   3. Ctrl+F5 で強制再読み込み（キャッシュクリア）
   ```

3. **拡張機能の権限確認**
   ```
   1. chrome://extensions/ で "Multi Channel Reply Support Tool" を開く
   2. 「サイトアクセス」が「すべてのサイト」または「クリック時」になっているか確認
   3. 必要に応じて「すべてのサイト」に変更
   ```

4. **コンソールエラー確認**
   ```
   1. 対象サイトでF12を押してDevToolsを開く
   2. Consoleタブでエラーメッセージを確認
   3. エラーがあれば具体的な内容をサポートに報告
   ```

**✅ 解決確認**: 対象サイトでAI返信ボタンが正常に表示される

---

### ❓ Q8: 返信生成に時間がかかりすぎる（10秒以上）

**症状**: AI返信ボタンクリック後、返信生成に異常に時間がかかる

**パフォーマンス改善策**:

1. **会話履歴の長さ確認**
   ```
   原因: 非常に長い会話履歴（100メッセージ以上）
   対策: 必要な部分のみに絞った短い履歴で実行
   ```

2. **ネットワーク速度テスト**
   ```
   1. speedtest.net で回線速度を測定
   2. 安定した高速回線での使用推奨
   3. モバイル回線より固定回線を推奨
   ```

3. **Chrome パフォーマンス確認**
   ```
   1. chrome://settings/performance でメモリセーバーを有効化
   2. 不要なタブを閉じる
   3. 他の重い拡張機能を一時的に無効化
   ```

4. **APIサーバー状況確認**
   ```
   Google AI Studio のステータスページで障害情報を確認
   ピーク時間を避けた使用
   ```

**✅ 解決確認**: 3秒以内で安定した返信生成が可能

---

### ❓ Q9: 生成された返信が期待と異なる・品質が低い

**症状**: AIが生成した返信が文脈に合わない、または不自然

**返信品質改善方法**:

1. **会話コンテキストの改善**
   ```
   ✅ 効果的な使用パターン:
   - 5-20メッセージ程度の適度な履歴
   - 具体的な質問や要求を含む会話
   - 日本語での一貫した会話
   
   ❌ 避けるべきパターン:
   - 1-2メッセージのみの短すぎる履歴
   - 絵文字やスタンプのみの会話
   - 多言語が混在する会話
   ```

2. **会話の準備**
   ```
   重要な背景情報を会話に含める:
   - プロジェクト名や案件名
   - 相手の立場や関係性
   - 具体的な依頼内容や質問
   ```

3. **手動調整の活用**
   ```
   1. 生成された返信をベースとして使用
   2. 企業トーンや個人の文体に調整
   3. 専門用語や固有名詞を追加・修正
   ```

**✅ 解決確認**: ビジネスシーンに適した高品質な返信が生成される

---

### ❓ Q10: ドラッグ&ドロップが機能しない

**症状**: 生成された返信テキストをドラッグしても移動できない

**解決手順**:

1. **ブラウザ設定確認**
   ```
   chrome://settings/content/javascript でJavaScriptが有効か確認
   ```

2. **テキスト選択の確認**
   ```
   1. 返信テキストが正しく選択されているか確認
   2. 全文選択: Ctrl+A（Windows）/ Cmd+A（Mac）
   3. 部分選択: マウスドラッグで必要部分を選択
   ```

3. **対象要素の確認**
   ```
   ドロップ先が正しい入力要素か確認:
   - Gmail: 返信・作成画面の本文エリア
   - Chatwork: メッセージ入力ボックス
   - Google Chat: メッセージ作成エリア
   ```

4. **他拡張機能との競合確認**
   ```
   1. シークレットモードで動作確認
   2. 他の拡張機能を一時的に無効化
   3. 競合する拡張機能の特定と調整
   ```

**✅ 解決確認**: スムーズなドラッグ&ドロップ操作が可能

---

### ❓ Q11: 自動送信機能で送信できない

**症状**: 自動送信ボタンをクリックしても実際に送信されない

**診断・解決手順**:

1. **UI要素の変更確認**
   ```
   各サービスのUI更新により送信ボタンの位置や属性が変更されている可能性
   手動送信で一旦代替、アップデート確認
   ```

2. **確認ダイアログの確認**
   ```
   1. 自動送信前の確認ダイアログが表示されるか確認
   2. 「送信実行」ボタンを確実にクリック
   3. 送信内容の最終確認
   ```

3. **権限・セキュリティ確認**
   ```
   1. サイトでの自動操作がブロックされていないか確認
   2. Content Security Policy (CSP) エラーの確認
   3. ブラウザのポップアップブロック設定
   ```

4. **フォールバック手順**
   ```
   1. 生成された返信をコピー（Ctrl+C）
   2. 手動で入力欄に貼り付け（Ctrl+V）
   3. 手動で送信ボタンをクリック
   ```

**✅ 解決確認**: 確認ダイアログ経由で正常な自動送信が可能

---

## ⚡ パフォーマンス関連

### ❓ Q12: 拡張機能でChromeが重くなる

**症状**: 拡張機能使用後、Chromeの動作が遅くなる

**最適化手順**:

1. **メモリ使用量確認**
   ```
   chrome://settings/performance でメモリ使用量を確認
   推奨: 拡張機能は50MB以下の使用量
   ```

2. **不要な機能の無効化**
   ```
   設定で使用しないサービスの機能を無効化:
   - 使用しないサービス (LINE, Chatworkなど)
   - 自動送信機能（必要時のみ有効化）
   ```

3. **キャッシュクリア**
   ```
   1. 拡張機能ポップアップ → 設定
   2. 「キャッシュクリア」ボタンをクリック
   3. 不要な会話履歴データを削除
   ```

4. **Chrome全体の最適化**
   ```
   1. chrome://settings/performance でメモリセーバーを有効化
   2. 不要なタブを閉じる
   3. Chrome を定期的に再起動
   ```

**✅ 解決確認**: Chrome が軽快に動作し、拡張機能も正常に機能

---

### ❓ Q13: 大量のメッセージがある会話で動作が重い

**症状**: 長いメッセージ履歴がある会話で返信生成が重い・失敗する

**対処法**:
1. **会話履歴の制限**
   ```
   直近の重要なメッセージ（10-20件）のみを対象に使用
   古いメッセージは手動で非表示にしてから実行
   ```

2. **分割処理**
   ```
   長い会話を複数の短いセクションに分けて処理
   必要な文脈のみを抽出して使用
   ```

3. **設定調整**
   ```
   拡張機能設定でメッセージ取得数を制限
   （将来のアップデートで対応予定）
   ```

**✅ 解決確認**: 大量メッセージ環境でも安定した動作

---

## 🌐 互換性関連

### ❓ Q14: 特定のGmailテーマ・レイアウトで動作しない

**症状**: Gmail のカスタムテーマや新UIで機能しない

**対応策**:
1. **標準テーマに変更**
   ```
   Gmail設定 → テーマ → 「標準」を選択
   ```

2. **旧UIの使用**
   ```
   Gmail右上の設定 → 「以前のGmailに戻る」（利用可能な場合）
   ```

3. **レイアウト調整**
   ```
   Gmail設定 → 表示 → 「コンパクト」表示を選択
   ```

**✅ 解決確認**: カスタムテーマでも正常にボタンが表示

---

### ❓ Q15: Chrome以外のブラウザで使いたい

**症状**: Firefox、Edge、Safariでも使用したい

**現状と今後の対応**:
```
❌ 現在: Chrome専用（Manifest V3）
🔄 今後の予定:
- Firefox対応 (Manifest V2/V3 ハイブリッド)
- Edge対応 (Chrome拡張機能互換)
- Safari対応 (Safari App Extension)
```

**代替手段**:
```
1. Chromeブラウザの併用
2. WebベースAPIの直接利用（上級者向け）
3. ブックマークレット版の開発検討
```

---

### ❓ Q16: 企業のセキュリティポリシーで制限される

**症状**: 企業・学校のネットワークでブロックされる

**企業IT部門向け説明**:

1. **必要なドメイン許可**
   ```
   許可が必要なドメイン:
   - generativelanguage.googleapis.com (Gemini API)
   - ai.google.dev (APIキー管理)
   - chrome.google.com (拡張機能ストア)
   ```

2. **セキュリティ評価情報**
   ```
   - Manifest V3準拠（最新セキュリティ基準）
   - ローカルデータ保存のみ（外部送信なし）
   - オープンソース（コード監査可能）
   - Google API使用（企業グレードセキュリティ）
   ```

3. **プライバシー保護**
   ```
   - メッセージ内容の外部保存なし
   - APIキーのローカル暗号化保存
   - ログ・分析データの収集なし
   ```

**✅ 解決確認**: 企業ポリシー下での安全な使用が可能

---

## 🔧 高度なトラブルシューティング

### ❓ Q17: コンソールエラーの解読と対処

**症状**: DevToolsコンソールにエラーメッセージが表示される

**主要エラーパターンと解決策**:

1. **Content Security Policy (CSP) エラー**
   ```
   エラー例: "Refused to execute inline script because it violates CSP"
   解決策: 拡張機能のアップデート確認、サイトのCSP設定確認
   ```

2. **CORS (Cross-Origin Resource Sharing) エラー**
   ```
   エラー例: "CORS policy: No 'Access-Control-Allow-Origin' header"
   解決策: APIキーの再設定、ネットワーク設定確認
   ```

3. **DOM要素参照エラー**
   ```
   エラー例: "Cannot read property 'addEventListener' of null"
   解決策: ページ完全読み込み後に機能使用、UI変更の可能性
   ```

**✅ 解決確認**: コンソールエラーが解消し、正常動作する

---

### ❓ Q18: 拡張機能のログ・診断情報の取得

**開発者・サポート向け診断情報収集**:

1. **基本情報収集**
   ```javascript
   // Consoleで実行
   console.log({
     userAgent: navigator.userAgent,
     chromeVersion: navigator.userAgent.match(/Chrome\/(\d+)/)[1],
     extensionVersion: chrome.runtime.getManifest().version,
     url: window.location.href
   });
   ```

2. **拡張機能状態確認**
   ```javascript
   // 権限確認
   chrome.permissions.getAll((permissions) => {
     console.log('Permissions:', permissions);
   });
   
   // ストレージ使用量確認
   chrome.storage.local.getBytesInUse((bytes) => {
     console.log('Storage usage:', bytes, 'bytes');
   });
   ```

3. **エラーログ収集**
   ```
   1. chrome://extensions/ → 拡張機能詳細 → "エラー" タブ
   2. Service Worker → "検査" → Console タブ
   3. 対象サイト → F12 → Console タブ
   ```

**✅ サポート提供**: 収集した情報をサポートチームに提供

---

## 📞 サポート・問い合わせ

### 🆘 即座に解決できない場合

1. **ドキュメント確認**
   - USER_MANUAL.md: 詳細な使用方法
   - QUICK_START_GUIDE.md: 基本操作
   - CROSS_BROWSER_TEST_RESULTS.md: 動作環境

2. **GitHub Issues**
   - バグレポート: 再現手順の詳細記載
   - 機能要望: 具体的な使用ケース説明
   - 質問: 既存Issuesの検索後に投稿

3. **Chrome Web Store レビュー**
   - 一般的な評価・感想
   - 簡潔な問題報告

### 📊 品質向上への貢献

**問題報告時の推奨情報**:
```
環境情報:
- Chrome バージョン: 
- OS: 
- 拡張機能バージョン: 
- 使用サービス: 

問題詳細:
- 発生頻度: 
- 再現手順: 
- エラーメッセージ: 
- 期待される動作: 
```

**🎯 このガイドで解決率95%以上を目指し、快適な拡張機能利用を実現します！**